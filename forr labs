// Эта процедура выполняется при проведении документа
Процедура ОбработкаПроведения(Отказ, Режим)
    
    // Проверяем, что сотрудник выбран
    Если Сотрудник = Неопределено Тогда
        Сообщить("Не выбран сотрудник!");
        Возврат;
    КонецЕсли;
    
    // Проверяем, что сумма начисления указана
    Если Начислено = 0 Тогда
        Сообщить("Сумма начисления не указана!");
        Возврат;
    КонецЕсли;
    
    // Получаем налоговую ставку сотрудника
    СтавкаНалога = Сотрудник.НалоговаяСтавка;
    
    // Проверяем, что ставка указана
    Если СтавкаНалога = 0 Тогда
        Сообщить("У сотрудника не указана налоговая ставка!");
        Возврат;
    КонецЕсли;
    
    // Рассчитываем налог
    НалогРассчитанный = Начислено * СтавкаНалога / 100;
    
    // Сохраняем налог в документе
    Объект.Налог = НалогРассчитанный;
    
КонецПроцедуры

// Эта процедура проверяет данные перед сохранением
Процедура ПередЗаписью(Отказ)
    
    // Проверяем обязательные поля
    Если Сотрудник = Неопределено Тогда
        Отказ = Истина;
        Сообщить("Не выбран сотрудник!");
        Возврат;
    КонецЕсли;
    
    Если Начислено <= 0 Тогда
        Отказ = Истина;
        Сообщить("Сумма начисления должна быть больше 0!");
        Возврат;
    КонецЕсли;
    
КонецПроцедуры

// Этот код выполняется когда пользователь меняет сумму
Процедура НачисленоПриИзменении(Элемент)
    
    // Если сотрудник выбран и сумма указана
    Если Сотрудник <> Неопределено И Начислено > 0 Тогда
        
        // Получаем ставку налога сотрудника
        Ставка = Сотрудник.НалоговаяСтавка;
        
        // Рассчитываем налог
        НалогРассчитанный = Начислено * Ставка / 100;
        
        // Показываем налог в поле
        ЭлементыФормы.Налог.Значение = НалогРассчитанный;
        
    КонецЕсли;
    
КонецПроцедуры