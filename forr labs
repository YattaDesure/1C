// Модуль объекта документа Продажи

// Событие при записи документа (работает всегда)
Процедура ПередЗаписью(Отказ)
    
    // Автоматически рассчитываем бонус при записи
    Если Сотрудник <> Неопределено И СуммаПродаж > 0 Тогда
        РассчитатьБонус();
    КонецЕсли;
    
КонецПроцедуры

Процедура РассчитатьБонус()
    
    // Простой расчет
    ЗначСкидка = ?(Скидка = Неопределено, 0, Скидка);
    ЗначВозврат = ?(Возврат = Неопределено, 0, Возврат);
    
    ЧистаяСумма = СуммаПродаж - ЗначСкидка - ЗначВозврат;
    Если ЧистаяСумма < 0 Тогда
        ЧистаяСумма = 0;
    КонецЕсли;
    
    Бонус = Окр(ЧистаяСумма * 0.05, 2);
    
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, Режим)
    
    // Простые проверки
    Если Сотрудник = Неопределено Тогда
        Отказ = Истина;
        Возврат;
    КонецЕсли;
    
    Если СуммаПродаж <= 0 Тогда
        Отказ = Истина;
        Возврат;
    КонецЕсли;
    
    // Бонус уже рассчитан в ПередЗаписью
    
КонецПроцедуры