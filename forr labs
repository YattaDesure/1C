// Модуль объекта документа Продажи
// События для каждого поля

// При изменении сотрудника
Процедура СотрудникПриИзменении()
    РассчитатьБонус();
КонецПроцедуры

// При изменении суммы продаж
Процедура СуммаПродажПриИзменении()
    РассчитатьБонус();
КонецПроцедуры

// При изменении скидки
Процедура СкидкаПриИзменении()
    РассчитатьБонус();
КонецПроцедуры

// При изменении возврата
Процедура ВозвратПриИзменении()
    РассчитатьБонус();
КонецПроцедуры

// Процедура расчета бонуса
Процедура РассчитатьБонус()
    
    // Если нет сотрудника или суммы - бонус 0
    Если Сотрудник = Неопределено Или СуммаПродаж <= 0 Тогда
        Бонус = 0;
        Возврат;
    КонецЕсли;
    
    // Скидка (если не указана - 0)
    ЗначениеСкидки = 0;
    Если Скидка <> Неопределено Тогда
        ЗначениеСкидки = Скидка;
    КонецЕсли;
    
    // Возврат (если не указан - 0)
    ЗначениеВозврата = 0;
    Если Возврат <> Неопределено Тогда
        ЗначениеВозврата = Возврат;
    КонецЕсли;
    
    // Чистая сумма
    ЧистаяСумма = СуммаПродаж - ЗначениеСкидки - ЗначениеВозврата;
    
    // Если отрицательно - 0
    Если ЧистаяСумма < 0 Тогда
        ЧистаяСумма = 0;
    КонецЕсли;
    
    // Бонус = 5% от чистой суммы
    Бонус = ЧистаяСумма * 0.05;
    
КонецПроцедуры

// Проведение документа
Процедура ОбработкаПроведения(Отказ, Режим)
    
    // Проверки
    Если Сотрудник = Неопределено Тогда
        Отказ = Истина;
        Сообщить("Выберите сотрудника!");
        Возврат;
    КонецЕсли;
    
    Если СуммаПродаж <= 0 Тогда
        Отказ = Истина;
        Сообщить("Введите сумму продаж!");
        Возврат;
    КонецЕсли;
    
    Сообщить("Документ проведен. Бонус: " + Бонус);
    
КонецПроцедуры