&НаКлиенте
Процедура СотрудникПриИзменении(Элемент)
    
    // Получаем текущего сотрудника из формы
    ТекущийСотрудник = ЭлементыФормы.Сотрудник.Значение;
    
    Если ТекущийСотрудник <> Неопределено Тогда
        // Автоматически подставляем оклад сотрудника
        Объект.Начислено = ТекущийСотрудник.Оклад;
        ЭлементыФормы.Начислено.Значение = ТекущийСотрудник.Оклад;
    Иначе
        Объект.Начислено = 0;
        ЭлементыФормы.Начислено.Значение = 0;
        Объект.Налог = 0;
        ЭлементыФормы.Налог.Значение = 0;
    КонецЕсли;
    
    // Вызываем расчет налога
    НачисленоПриИзменении(Элемент);
    
КонецПроцедуры

&НаКлиенте
Процедура НачисленоПриИзменении(Элемент)
    
    // Получаем значения из формы
    ТекущийСотрудник = ЭлементыФормы.Сотрудник.Значение;
    ТекущееНачислено = ЭлементыФормы.Начислено.Значение;
    
    // Проверяем, что сотрудник выбран
    Если ТекущийСотрудник = Неопределено Тогда
        Объект.Налог = 0;
        ЭлементыФормы.Налог.Значение = 0;
        Возврат;
    КонецЕсли;
    
    // Проверяем, что сумма указана и положительная
    Если ТекущееНачислено = Неопределено ИЛИ ТекущееНачислено <= 0 Тогда
        Объект.Налог = 0;
        ЭлементыФормы.Налог.Значение = 0;
        Возврат;
    КонецЕсли;
    
    // Проверяем, что ставка налога указана
    Если ТекущийСотрудник.НалоговаяСтавка = 0 Тогда
        Объект.Налог = 0;
        ЭлементыФормы.Налог.Значение = 0;
        Возврат;
    КонецЕсли;
    
    // Рассчитываем налог
    Ставка = ТекущийСотрудник.НалоговаяСтавка;
    СуммаНалога = ТекущееНачислено * Ставка / 100;
    СуммаНалога = Окр(СуммаНалога, 2);
    
    // Устанавливаем рассчитанный налог
    Объект.Налог = СуммаНалога;
    ЭлементыФормы.Налог.Значение = СуммаНалога;
    
КонецПроцедуры